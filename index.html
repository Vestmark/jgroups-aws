<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-08-17 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170817" />
    <meta http-equiv="Content-Language" content="en" />
    <title>JGroups AWS Discovery &#x2013; AWS Auto Discovery for JGroups</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
                      <a href="https://github.com/meltmedia/jgroups-aws">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>JGroups AWS Discovery</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2017-08-17<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.6.0</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Overview</li>
    <li class="active"><a href="#"><span class="none"></span>Usage</a>
  </li>
    <li><a href="apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a>  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-down"></span>Project Information</a>
      <ul class="nav nav-list">
    <li><a href="dependencies.html" title="Dependencies"><span class="none"></span>Dependencies</a>  </li>
    <li><a href="dependency-info.html" title="Dependency Information"><span class="none"></span>Dependency Information</a>  </li>
    <li><a href="distribution-management.html" title="Distribution Management"><span class="none"></span>Distribution Management</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>About</a>
  </li>
    <li><a href="license.html" title="Licenses"><span class="none"></span>Licenses</a>  </li>
    <li><a href="plugin-management.html" title="Plugin Management"><span class="none"></span>Plugin Management</a>  </li>
    <li><a href="plugins.html" title="Plugins"><span class="none"></span>Plugins</a>  </li>
    <li><a href="source-repository.html" title="Source Code Management"><span class="none"></span>Source Code Management</a>  </li>
    <li><a href="project-summary.html" title="Summary"><span class="none"></span>Summary</a>  </li>
      </ul>
  </li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
          <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
        <div class="g-plusone" data-href="http://meltmedia.github.com/jgroups-aws" data-size="tall" ></div>
                  <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>AWS Auto Discovery for JGroups</h1>
<div class="section">
<h2><a name="Overview"></a>Overview</h2>
<p>This package provides auto discovery for other custer members on AWS using both tag matching and filters. It is a drop in replacement for TCPPING, allowing you to remove the definition of your initial members from your configuraiton file.</p></div>
<div class="section">
<h2><a name="Usage"></a>Usage</h2>
<p>To use AWS auto discovery, you need to add a dependency to this package in your pom:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;dependency&gt;
  &lt;groupId&gt;com.meltmedia.jgroups&lt;/groupId&gt;
  &lt;artifactId&gt;jgroups-aws&lt;/artifactId&gt;
  &lt;version&gt;1.3.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div></div>
<p>and then replace TCPPING in your stack with com.meltmedia.jgroups.aws.AWS_PING:</p>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;com.meltmedia.jgroups.aws.AWS_PING
     port_number=&quot;7800&quot;
     tags=&quot;TAG1,TAG2&quot;
     filters=&quot;NAME1=VALUE1,VALUE2;NAME2=VALUE3&quot;
     access_key=&quot;AWS_ACCESS_KEY&quot;
     secret_key=&quot;AWS_SECRET_KEY&quot;/&gt;
</pre></div></div>
<p>see the configuration section for information. You can find an example stack in conf/aws_ping.xml.</p>
<p>This implementation will only work from inside EC2, since it uses environment information to auto wire itself. See the Setting Up EC2 section for more information.</p></div>
<div class="section">
<h2><a name="Configuration_Options"></a>Configuration Options</h2>

<ul>
  
<li>port_number - the port number that the nodes will communicate over. This needs to be the same on all nodes. The default is 7800.</li>
  
<li>tags - A comma delimited list of EC2 node tag names. The current nodes values are matched against other nodes to find cluster members.</li>
  
<li>filters - A colon delimited list of filters. Each filter defines a name and a comma delimited list of possible values. All filters must match a node for it to be a cluster member.</li>
  
<li>access_key and secret_key - the access key and secret key for an AWS user with permission to the &#x201c;ec2:Describe*&#x201d; action. If both of these attributes are not specified, then the instance profile for the EC2 instance will be used (Since version 1.1).</li>
  
<li>credentials_provider_class - the fully qualified name of the com.amazonaws.auth.AWSCredentialsProvider to use (Since version 1.3). This option can only be used when the access_key and secret_key options are not provided.</li>
</ul></div>
<div class="section">
<h2><a name="Setting_Up_EC2"></a>Setting Up EC2</h2>
<p>You will need to setup the following in EC2, before using this package:</p>

<ul>
  
<li>The EC2 instances will need permission to the &#x201c;ec2:Describe*&#x201d; action. You can either create an IAM user with this permission and pass the users credentials with the access_key and secret_key attributes or associate an instance profile with that permission to the instances and not specify the access_key and secret_key attributes.</li>
  
<li>In the EC2 console, you will need to create a security group for your instances. This security group will need a TCP_ALL rule, with itself as the source (put the security group&#x2019;s name in the source field.) This will allow all of the nodes in that security group to communicate with each other.</li>
  
<li>Create two EC2 nodes, making sure to include the security group granting TCP communication.</li>
  
<li>If you are going to use the tag matching feature, then define a few tags on the nodes with matching values.</li>
</ul></div>
<div class="section">
<h2><a name="Setting_up_JGroups_Chat_Demo"></a>Setting up JGroups Chat Demo</h2>
<p>The JGroups project provides a chat application that is great for testing your configuration. To set up the chat application, first create two EC2 nodes, following the Setting Up EC2 instructions. Once the nodes are created, SSH into each machine and install the java 8 JDK, Maven 3, and Git.</p>

<div class="source">
<div class="source"><pre class="prettyprint">sudo apt-get install openjdk-8-jdk
wget http://www.carfab.com/apachesoftware/maven/binaries/apache-maven-3.0.4-bin.tar.gz
sudo tar xzf apache-maven-3.0.4-bin.tar.gz /opt
ln -s /opt/maven /opt/apache-maven-3.0.4
echo &quot;export PATH=/opt/maven/bin:$PATH&quot; &gt;&gt; .profile
. ~/.profile
sudo apt-get install git
mkdir ~/git
</pre></div></div>
<p>Now your machine is ready to compile maven projects.</p>
<p>Next, clone and build this project.</p>

<div class="source">
<div class="source"><pre class="prettyprint">cd ~/git
git clone git://github.com/meltmedia/jgroups-aws.git
cd jgroups-aws
mvn clean install
</pre></div></div>
<p>Finally, it is time to run the project. You will need to edit the configuration in conf/aws-ping.xml. Add values for the tags, access_key and secret_key attributes. Remove the filters attribute. Then execute the following:</p>

<div class="source">
<div class="source"><pre class="prettyprint">mvn exec:java -Dexec.mainClass=&quot;org.jgroups.demos.Chat&quot; -Dexec.args=&quot;-props conf/aws-ping.xml&quot;
</pre></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2012&#x2013;2017
<a href="https://www.meltmedia.com">meltmedia</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
